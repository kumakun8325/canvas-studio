# Auto-continue workflow: Report PR merge completion and list remaining Issues
#
# After PR merge, this workflow lists remaining open Issues with claude-auto label.
# The user (Antigravity) will then manually trigger the next Issue based on dependencies.

name: Claude Auto-Continue

on:
  pull_request:
    types: [closed]

jobs:
  report-completion:
    # Only run when PR is merged (not just closed)
    if: github.event.pull_request.merged == true

    runs-on: ubuntu-latest

    permissions:
      issues: read

    steps:
      - name: List remaining open Issues with claude-auto label
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "## PR Merged: ${{ github.event.pull_request.title }}"
          echo ""
          echo "### Remaining Issues with claude-auto label:"
          echo ""

          gh issue list \
            --repo ${{ github.repository }} \
            --label claude-auto \
            --state open \
            --json number,title \
            --jq '.[] | "- #\(.number): \(.title)"'

          REMAINING=$(gh issue list \
            --repo ${{ github.repository }} \
            --label claude-auto \
            --state open \
            --json number \
            --jq 'length')

          if [ "$REMAINING" == "0" ]; then
            echo ""
            echo "ðŸŽ‰ All Issues with claude-auto label have been completed!"
          else
            echo ""
            echo "ðŸ“‹ $REMAINING Issue(s) remaining. Antigravity will select the next one based on dependencies."
          fi
