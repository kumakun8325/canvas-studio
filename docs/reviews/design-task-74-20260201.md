# Design Review: TASK-074 ダークモード対応

> **Reviewer**: GPT-5.2-Codex (xhigh)
> **Date**: 2026-02-01
> **Model**: gpt-5.2-codex (100.1k in, 22.1k out)

---

### 総評
ダークモード設計は層構造に概ね準拠するが、初期適用タイミングとキャンバス背景要件の詰めが必要。

### スコア
| 観点 | スコア (1-5) | コメント |
|------|-------------|---------|
| アーキテクチャ整合性 | 4 | Hooks/Store分離で概ね準拠 |
| 型安全性 | 3 | localStorage値の型ガードが必要 |
| テスト容易性 | 4 | useTheme単体化とmatchMediaモック済 |
| パフォーマンス | 4 | htmlクラス切替中心で軽微 |
| セキュリティ | 4 | 永続化はlocalStorageのみ |
| 拡張性 | 4 | ThemeMode導入で拡張余地 |
| 既存コードとの整合性 | 3 | 監視ロジック統一の余地 |

### 良い点
- useTheme + darkクラスで責務分離
- matchMedia/永続化/テスト方針が明確

### 問題点（重要度順）
1. **Major**: CanvasViewにdark背景を付与すると「キャンバス背景は灰色固定」の要件と競合
   - 理由: 背景色のテーマ追従で視覚一貫性低下
   - 修正案: Canvas周辺は固定色 or 変数で同値
2. **Major**: 初期描画後に`<html>`へdarkクラス付与だとFOUC
   - 理由: 初回ロードでライト→ダークのフラッシュ
   - 修正案: index.htmlのインラインスクリプト等で事前付与
3. **Minor**: localStorage値の型ガード未定義
   - 理由: 不正値混入時のThemeMode崩壊
   - 修正案: ThemeMode検証関数＋systemフォールバック

### リスク
- editorStoreへのisDarkMode追加で広い再レンダリング
- ダーク配色のAAコントラスト実測不足

### 推奨事項
- useMediaQuery再利用 or usePrefersColorScheme導入で監視ロジック統一
- system→toggle挙動の仕様固定とUI文言の明示
